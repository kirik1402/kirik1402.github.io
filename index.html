<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Leaflet KML Example</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-omnivore@0.3.4/leaflet-omnivore.min.js"></script>
</head>
<body>
    <div id="map" style="width: 100%; height: 600px;"></div>
    <script>
        // Инициализация карты Leaflet
        var map = L.map('map').setView([0, 0], 2);

        // Добавление базового слоя карты
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // URL для доступа к файлу KML в Firebase Storage
        var kmlUrl = 'https://firebasestorage.googleapis.com/v0/b/kml360.appspot.com/o/trek.kml?alt=media&token=1036fd6f-0405-4043-8243-75f4051d553f';

        // Использование прокси-сервера для обхода CORS
        var proxyUrl = 'https://cors-anywhere.herokuapp.com/';
        var proxiedKmlUrl = proxyUrl + kmlUrl;

        // Загрузка файла KML с использованием fetch
        fetch(proxiedKmlUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text();
            })
            .then(kmlText => {
                console.log("KML файл загружен успешно");
                var kmlLayer = omnivore.kml.parse(kmlText);
                kmlLayer.addTo(map);
                // Центрирование карты на слое KML
                map.fitBounds(kmlLayer.getBounds());
            })
            .catch(error => {
                console.error('Ошибка при загрузке KML файла:', error);
            });
    </script>
</body>
</html>
